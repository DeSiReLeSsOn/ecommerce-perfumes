{% extends "shop/base.html" %}
{% load static %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" integrity="sha384-abcdef" crossorigin="anonymous">
{% block title %}
{% if category %}{{ category.name }}{% else %}Товары{% endif %}
{% endblock %}
{% block content %}

<div class="product_section layout_padding" style="margin-top: 10px;">
    <div class="container">
        <div class="product_section_2 layout_padding">
            <div class="row">
                {% for product in products %}
                <div class="col-lg-3 col-md-4 col-sm-6 col-12">
                    <div class="product_box">
                        <h4 class="bursh_text">{{ product.name }}</h4>
                        <p class="lorem_text">{{ product.description }}</p>
                        <img src="{% if product.image %}{{ product.image.url }}{% else %}{% static "img/no_image.jpg" %}{% endif %}" class="image_1">
                        <div class="btn_main">
                            <div class="buy_bt">
                                <ul>
                                    <li ><a href="{{ product.get_absolute_url }}">Buy Now</a></li>
                                    <li>
                                    <a href="javascript:void(0);" onclick="addToFavorites({{ product.id }})">
                                        <i id="heart-icon-{{ product.id }}" class="fas fa-heart"></i> 
                                    </a>
                                    </li>
                                </ul>
                            </div>
                            <h3 class="price_text">{{ product.price }}</h3>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>
{% csrf_token %}


<script>
    const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;
    function addToFavorites(product_id) {
    fetch(`/add-to-favorite/${product_id}/`, {
        method: 'POST',
        headers: {
            'X-CSRFToken': csrftoken,
            'Content-Type': 'application/json'
        },
    })
    .then(response => response.json())
    .then(data => {
        if (data.created) {
            alert(data.message); // Показать сообщение об успешном добавлении товара
            // Изменить цвет иконки сердечка на другой цвет
            const heartIcon = document.getElementById(`heart-icon-${product_id}`);
            heartIcon.style.color = 'red'; // Измените цвет на желаемый, в данном случае на красный
        } else {
            alert(data.message); // Показать сообщение о том, что товар уже в избранном
        }
    })
    .catch(error => {
        console.error('Ошибка:', error);
    });
}
</script>


{% endblock %}